# 副本集 Replica Sets

副本集类似于有自动故障恢复功能的主从集群。利用多态机器进行统一数据的异步同步，从而使多态机器拥有同一数据的多个副本，并且当主库down掉时自动切换其他备份服务器做主库。还可以做主从读写分离。

## 冗余和数据可用性

- 复制提供冗余并提高数据可用性。
- 复制可提供一定级别的容错，防止丢失单个数据库服务器

## MongoDB中的复制

- 副本集是一组维护相同数据集的mongod实例。

- 副本集包含多个数据承载节点和一个可选的仲裁节点。

  - 在承载数据的节点中，一个且仅一个成员被视为主节点，而其他节点被视为从节点。

  - 主节点接收所有写操作。副本集只能有一个主要能够确认具有{w:"most"}写入关注的写入。虽然在某些情况下，另一个mongod实例可能暂时认为自己也是主节点。

  - oplog，由主节点记录其操作日志中的数据集的所有更改。

    - 从节点复制主节点的oplog并将操作应用于其数据集。

    ![image-20201118103948612](.pics/image-20201118103948612.png)



- 主从复制和副本集的区别
  - 副本集没有固定的主节点，整个集群会选出一个主节点。副本集总有一个活跃点（主）和一个或多个从节点。

# 副本集的三个角色

两种类型，三个角色

- 两种类型：

  - 主 Primary
  - 从 Secondaries

- 三个角色

  - 主 Primary

  - 从 SecondAries

  - 仲裁 Arbiter 

    - 也是一种从节点类型。

    - 不保留数据副本，只具有投票选举作用。

    - 也可以将仲裁服务器维护为副本集的一部分，即：副本集成员同时也可以是仲裁者。

    - 如果副本+主节点个数为偶数，需要添加仲裁者形成奇数。副本+主节点个数是奇数，可以不加仲裁者。

    - 仲裁者不需要专用硬件。

    - 主退出可以成为从，从可以选举成为主，仲裁者永远是仲裁者。

      