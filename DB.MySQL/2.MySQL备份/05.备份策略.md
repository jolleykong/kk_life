# 备份策略

## 备份要考虑的事情

- 备份记录信息
  - 开始时间、完成时间
  - 备份的大小
  - apply-log是否成功（Xtrabackup）
  - 和前次备份对比数据变化情况



- 核心数据的备份策略

  - 大于1TB的数据库，应考虑拆分或是使用TokuDB压缩存储。
  - 再大的库使用延迟复制，根据需要进行归档
  - 每天全备并传入备份存储系统
  - Binlog实时备份到专门的Binlog备份机器

  

- 增量备份策略

  - 每个实例的Binlog保存3天，实时备份Binlog，可以达到还原到出错的最近时间点

## 备份安全相关

- 备份存放

  - HDFS & CEPH
  - 不允许手工删除，进行过期删除策略。（S3文件存储，只能写，无权删）
  - 每天有数据校验

  

- 备份最好加密存放，如加密压缩或是利用openssl加密



## 恢复测试

- 备份恢复测试
  - 每天5-10个实例抽样，轮询进行保障
  - 抽样方法
    - 提前埋点，设计一个具有时效性的数据标签、记号
    - 还原后能不能启动、数据大小是否正常
    - 对表做checksums



 



