[传送门：04.B树和B+树](..\..\..\6.MySQL索引\1.MySQL索引基础\04.B树和B+树.md)

### B+树容量

假设有一个表，只有一个INT列，且该列设置为pk。

B+树中，

| 每个非叶子节点开销                | (row  header) 6B + (int类型主键) 4B + (指向叶子结点的指针) 4B = 14B |                                                              |
| --------------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 每行数据开销                      | (叶子结点开销) 14B + (DB_TRX_ID) 6B +  (DB_ROLL_PTR) 7B = 27B | *( [ + (rowid ,**如果表未设置主键的话**) ]*                  |
| 每个非叶子节点page存储量约为      | ( 16*1024 - 128 ) / 14 = 1161行记录                          | *(**一个**page 16k -* *每*[*个**page**的必要占用* *128B*]()*) /* *每个非叶子节点开销* *14B* |
| 每个叶子结点page存储量约为        | ( 16*1024 - 128 ) / 27 = 600行记录                           | *(**一个**page 16k -* *每个**page**的必要占用* *128B) /* *每行数据开销* *27B* |
| 一个三层高的B+树，最多数据量约    | 1161 * 1161 * 600 ≈ 8亿行记录                                | *根节点存储量* *** *非叶子节点存储量* *** *叶子结点数据量*   |
|                                   |                                                              |                                                              |
| 叶子节点每行INT only数据占用      | (init 类型 4B) +  (DB_TRX_ID 6B) + (DB_ROLL_PTR 7B) + (record header 5B) = 22B |                                                              |
| 每4条记录一个slot，每个slot 2B    |                                                              |                                                              |
| 叶子节点每个page可以存放N条记录   | N*22 +  N/4 * 2 = 16*1024 -128                22.5N=16256                    N=722.48 | *128**为每*[*个**page**的必要占用* *128B*]()*。*             |
| 非叶子节点数据占用                | (每个指向叶子节点的指针 4B) + (int类型 4B) + (record header 5B) = 14B |                                                              |
| 非叶子节点每个page可以存放N条记录 | N*14 +  N/4 * 2 = 2 16*1024 - 128             14.5N=16256                N=1121 | *这个不一定对。没找到非叶子节点的结构图，先猜测*             |

 

[[老叶茶馆\] - 2019-08-10 浅析InnoDB Record Header及page overflow.html]()