[TOC]

# 性能容量规划

## 重点关注指标

### 业务指标

- 每秒并发用户请求
- 每秒订单数
- 用户请求响应时长

### 折算成性能指标

- qps
- tps
- rt

### 提出测试预期目标

- 根据性能指标制定测试方案
- 测试结果尽可能以这些指标来表达



从业务指标、用户指标换算成数据库指标，确定哪些维度真的要在数据库层进行实现，哪些维度可以通过前面使用cache来实现。

很多时候应用会发起一些空操作 select 0; 之类的，  这也会造成性能开销，需要注意包含。



## 业务指标

- 响应时间：用户发出请求到收到响应数据的时间
- 并发量：系统同时能处理多少用户请求
- 吞吐量：单位时间内系统处理的请求数量





### 参考模型：业务预期指标解读

- 读写比例

  读多写少、读少写多、读写相当、统计为主、纯写入

- 数据可靠性要求

  实时同步、异步、无所谓

- 用户端的语言及字符集

  latin1、utf8、utf8mb4

- 数据恢复的实时性要求

- 日新增数据量

- 数据库连接方式

- 历史数据归档方式

- 业务平均指标、峰值指标





#### 案例：一个不合理的设定

表存储用户账号及用户属性信息，只有两列，(id int primary key , data blob)，其中id为用户账号，data中保存了用户很多属性。任何一个属性只要有一个更新，都会导致整个blob列都进行更新。





### 业务目标评估要点

- 服务器配置

- 存储引擎选择

- 数据库高可用方案

- 数据库可用性方案

- 数据库备份方案

  > 尽量不要用lvm备份方案，会导致IO性能下降10%~30% 。
  >
  > 数据量小用逻辑备份更方便，超过10G用物理备份较方便



## 性能容量关键指标

- 每秒tps，峰值tps
- 基础数据量、日增长数据量
- 最大连接数
- 内存分配
- IOPS

 

> 内存泄漏（老叶茶馆）
>
> 传送门：[在MySQL 5.7下排查内存泄露和OOM问题全过程](.\在MySQL 5.7下排查内存泄露和OOM问题全过程.md)



## 各指标的优化方案

- CPU

  更换更好、更多核心的CPU

- I/O

  更换IOPS性能更高的设备

- 内存

  增加内存、合理分配

- MySQL

  升级版本，使用percona、MariaDB分支版本以支持更高TPS或者降低锁竞争力度

  选择InnoDB引擎，设计合适的表结构避免锁竞争
